# AIEN アーキテクチャ設計

このドキュメントでは、AIENアプリケーションの全体的なアーキテクチャ設計について説明します。

## システム概要

AIENは、AIを活用した英語学習アプリケーションで、以下の主要コンポーネントで構成されています：

1. **フロントエンドアプリケーション** - ユーザーインターフェースを提供
2. **バックエンドAPI** - ビジネスロジックとデータ管理を担当
3. **AI統合サービス** - AIモデルとの連携を管理
4. **データストア** - ユーザーデータと学習データの保存

## アーキテクチャ図

```
+-------------------+      +-------------------+      +-------------------+
|                   |      |                   |      |                   |
|  フロントエンド    +----->+   バックエンドAPI   +----->+   AI統合サービス   |
|  (React + TS)     |      |  (Node.js + TS)   |      |                   |
|                   |      |                   |      |                   |
+-------------------+      +--------+----------+      +---------+---------+
                                    |                           |
                                    v                           v
                           +--------+----------+      +---------+---------+
                           |                   |      |                   |
                           |   データストア     |      |   AIモデル        |
                           |   (MongoDB)      |      |   (Ollama/Bedrock) |
                           |                   |      |                   |
                           +-------------------+      +-------------------+
```

## コンポーネント詳細

### 1. フロントエンドアプリケーション

**技術スタック**:
- React 18
- TypeScript
- Tailwind CSS
- React Query
- Zustand

**主要機能**:
- チャットインターフェース
- 単語学習インターフェース
- ユーザー設定管理
- オフライン対応（PWA）

**アーキテクチャパターン**:
- コンポーネントベースアーキテクチャ
- カスタムフックによる関心の分離
- コンテキストAPIとZustandによる状態管理

### 2. バックエンドAPI

**技術スタック**:
- Node.js
- Express
- TypeScript
- MongoDB Driver
- WebSocket

**主要機能**:
- RESTful API
- WebSocketによるリアルタイム通信
- ユーザー認証と認可
- データ永続化

**アーキテクチャパターン**:
- レイヤードアーキテクチャ（コントローラー、サービス、モデル）
- 依存性注入
- ミドルウェアパターン

### 3. AI統合サービス

**技術スタック**:
- Node.js
- TypeScript
- Ollama API（フェーズ1）
- Amazon Bedrock SDK（フェーズ2）

**主要機能**:
- AIモデルとの通信
- プロンプト管理
- 応答最適化
- キャッシュ管理

**アーキテクチャパターン**:
- アダプターパターン（異なるAIモデル間の抽象化）
- ファクトリーパターン（AIモデルの生成）
- プロキシパターン（キャッシュと最適化）

### 4. データストア

**技術スタック**:
- MongoDB
- Redis（キャッシュ、フェーズ2）

**主要データモデル**:
- ユーザー
- 会話
- メッセージ
- 単語

## 通信フロー

### チャット機能の通信フロー

1. ユーザーがメッセージを入力
2. フロントエンドがWebSocketを通じてバックエンドにメッセージを送信
3. バックエンドがメッセージをデータベースに保存
4. バックエンドがAI統合サービスにメッセージを転送
5. AI統合サービスがAIモデルから応答を取得
6. 応答がバックエンドを経由してフロントエンドに返される
7. フロントエンドが応答を表示

### 単語学習機能の通信フロー

1. AIの応答からバックエンドが未知の単語を検出
2. 単語情報がデータベースに保存
3. フロントエンドが単語情報をAPIから取得
4. ユーザーが単語を学習済みとしてマーク
5. 学習状況がデータベースに更新

## セキュリティ設計

1. **認証**:
   - JWTベースの認証
   - HTTPSの強制

2. **データ保護**:
   - センシティブデータの暗号化
   - 適切なCORS設定

3. **入力検証**:
   - すべてのユーザー入力の検証
   - SQLインジェクション対策

## スケーラビリティ設計

1. **水平スケーリング**:
   - ステートレスなバックエンドAPI
   - 負荷分散の導入（フェーズ2）

2. **キャッシュ戦略**:
   - AI応答のキャッシュ
   - 頻繁にアクセスされるデータのキャッシュ

3. **非同期処理**:
   - 長時間実行タスクの非同期処理
   - メッセージキューの導入（フェーズ2）

## 監視とロギング

1. **アプリケーションログ**:
   - 構造化ログ形式
   - 異なるログレベル（info, warn, error）

2. **パフォーマンスモニタリング**:
   - API応答時間の監視
   - AIモデル呼び出しのパフォーマンス追跡

3. **エラー追跡**:
   - 集中型エラーログ
   - 自動アラート（重大なエラー）

## 将来の拡張性

このアーキテクチャは、以下の将来的な拡張を考慮して設計されています：

1. **音声会話機能**:
   - WebRTCの統合
   - 音声認識・合成サービスの追加

2. **複数AIモデル対応**:
   - アダプターパターンによる新モデルの容易な追加
   - モデル選択UIの拡張

3. **高度な学習分析**:
   - 学習データの分析サービスの追加
   - パーソナライズされた学習推奨機能

このアーキテクチャ設計は、プロジェクトの進行に合わせて定期的に見直し、必要に応じて更新していきます。
